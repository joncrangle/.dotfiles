{{- if eq .chezmoi.os "windows" }}

Write-Host ":: Chezmoi Hook: Syncing PowerShell profile" -ForegroundColor Cyan

# Use PowerShell to find the actual Documents path at runtime
$DocsPath = [Environment]::GetFolderPath("MyDocuments")
$Source = Join-Path "{{ .chezmoi.homeDir }}" ".config\powershell\Microsoft.PowerShell_profile.ps1"

$Targets = @(
    (Join-Path $DocsPath "PowerShell\Microsoft.PowerShell_profile.ps1"),
    (Join-Path $DocsPath "WindowsPowerShell\profile.ps1")
)

foreach ($Dest in $Targets) {
    $Dir = Split-Path $Dest -Parent

    if (-not (Test-Path $Dir)) {
        New-Item -Path $Dir -ItemType Directory -Force | Out-Null
    }

    if (Test-Path $Source) {
        Copy-Item -Path $Source -Destination $Dest -Force
        Write-Host "   -> Synced to: $Dest" -ForegroundColor Gray
    } else {
        Write-Warning "   -> Source profile not found: $Source"
    }
}

Write-Host "   -> Done." -ForegroundColor Green

{{- end }}
